$(document).ready(function(){


	// Initialize Firebase
	var config = {
		apiKey: "AIzaSyBkHsKXSIY2ApTPb9E1rnjEQ0OOT_7WuO8",
		authDomain: "train-ford.firebaseapp.com",
		databaseURL: "https://train-ford.firebaseio.com",
		storageBucket: "train-ford.appspot.com",
		messagingSenderId: "656972178308"
	};

	firebase.initializeApp(config);

	var database = firebase.database();


	var trainName = "";
	var destination = "";
	var firstTrain = "";
	var frequency = 0;
	var nextArrival = "12:30";
	var minutesUntilTrain = 0;
	var trainArray = []


	$(document).on("click", ".submit-button", function(){
		event.preventDefault();
		trainName = $(".name-input").val().trim();
		destination = $(".destination-input").val().trim();
		firstTrain = $(".first-input").val().trim();
		frequency = $(".frequency-input").val().trim();

		$(".name-input").val("");
		$(".destination-input").val("");
		$(".first-input").val("");
		$(".frequency-input").val("");
		// console.log(trainName);
		// console.log(destination);
		// console.log(firstTrain);
		// console.log(frequency);


		var addTrains = database.ref().push({
			trainName: trainName,
			destination: destination,
			firstTrain: firstTrain,
			frequency: frequency,
			id: ""
 		});

 		var trainID = addTrains.getKey();
 		console.log("ID: " + trainID);

 		database.ref(trainID).update({
 			id: trainID
 		});
	});


// // Generate a reference to a new location and add some data using push()
// DatabaseReference pushedPostRef = postsRef.push();

// // Get the unique ID generated by a push()
// String postId = pushedPostRef.getKey();


	database.ref().on("child_added", function(snapshot) {


		// console.log(snapshot.val());
		firstTrain = snapshot.val().firstTrain;
		frequency = snapshot.val().frequency;

		// First Time (pushed back 1 year to make sure it comes before current time)
	    var firstTimeConverted = moment(firstTrain, "hh:mm").subtract(1, "years");

	    // Current Time
	    var currentTime = moment();

	    // Difference between the times
	    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
	    console.log(diffTime);

	    // Time apart (remainder)
	    var tRemainder = diffTime % frequency;
	    console.log(tRemainder);

	    // Minute Until Train
	    var minutesUntilTrain = frequency - tRemainder;
	    console.log(minutesUntilTrain);

	    // Next Train
	    var nextArrivalUnformatted = moment().add(minutesUntilTrain, "minutes");
	    var nextArrival = moment(nextArrivalUnformatted).format("h:mm");


		trainArray.push({
			trainName: snapshot.val().trainName,
			firstTrain: firstTrain,
			destination: snapshot.val().destination,
			frequency: frequency,
			nextArrival: nextArrival,
			minutesUntilTrain: minutesUntilTrain	
		})

		console.log(trainArray);

		


		//create columns - add text
		// create row - add columns to row
		// add row at the end

		var addTrain = $(".train-schedule");
		var trainRow = $("<tr class= \"train-row "  + snapshot.val().id +  "\">");


		var trainColumnName = $("<td class=\"train-data train-data-name\">")
		.text(snapshot.val().trainName);

		var trainColumnFirstTrain = $("<td class= \"train-data train-data-firstTrain\">")
		.text(firstTrain);

		var trainColumnDestination = $("<td class=\"train-data train-data-destination\">")
		.text(snapshot.val().destination);

		var trainColumnFrequency = $("<td class=\"train-data train-data-frequency\">")
		.text(frequency);

		var trainColumnNextArrival = $("<td class=\"train-data train-data-next-arrival\">")
		.text(nextArrival);

		var trainColumnMinutesUntilTrain= $("<td class=\"train-data train-data-minutes-until-train\">")
		.text(minutesUntilTrain);

		var editButton = $("<button>");
		editButton.attr("class", "train-data train-data-edit btn btn-default")
		console.log(snapshot.val().id);
		editButton.attr("value", snapshot.val().id);
		editButton.html("Remove");

		trainRow.append(trainColumnName);
		trainRow.append(trainColumnDestination);
		trainRow.append(trainColumnFirstTrain);
		trainRow.append(trainColumnFrequency);
		trainRow.append(trainColumnNextArrival);
		trainRow.append(trainColumnMinutesUntilTrain);
		trainRow.append(editButton);
		addTrain.append(trainRow);


	}, function(errorObject) {
  		console.log("The read failed: " + errorObject.code);
	});

	database.ref().on("child_removed", function(snapshot) {
		location.reload();


	}, function(errorObject) {
  		console.log("The read failed: " + errorObject.code);
	});



	$(document).on("click", ".train-data-edit", function(){
		console.log(this.value);
		database.ref(this.value).remove();


	});

	// for (var i = 0; i < trainArray.length; i++) {


	// 	var addTrain = $(".train-schedule");
	// 	var trainRow = $("<tr class= \"train-row\">");

	// 	var trainColumnName = $("<td>");
	// 	trainColumnName.attr("class", "train-data train-data-name");
	// 	trainColumnName.html(trainArray[i].trainName);
	// 	console.log("name: " + trainColumnName);
	// 	var trainColumnFirstTrain = $("<td>");
	// 	trainColumnFirstTrain.attr("class", "train-data train-data-firstTrain");
	// 	var trainColumnDestination = $("<td>");
	// 	trainColumnDestination.attr("class", "train-data train-data-destination");
	// 	var trainColumnFrequency = $("<td>");
	// 	trainColumnFrequency.attr("class train-data train-data-frequency");
	// 	var trainColumnNextArrival = $("<td>");
	// 	trainColumnNextArrival.attr("class", "train-data train-data-next-arrival");
	// 	var trainColumnMinutesUntilTrain = $("<td>");
	// 	trainColumnMinutesUntilTrain.attr("class", "train-data train-data-minutes-until-train");
	// 	var editButton = $("<button>");
	// 	editButton.attr("class", "train-data train-data-edit btn btn-default");
	// 	editButton.html("EDIT");

	// 	trainRow.append(trainColumnName);
	// 	trainRow.append(trainColumnDestination);
	// 	trainRow.append(trainColumnFirstTrain);
	// 	trainRow.append(trainColumnFrequency);
	// 	trainRow.append(trainColumnNextArrival);
	// 	trainRow.append(trainColumnMinutesUntilTrain);
	// 	trainRow.append(editButton);
	// 	addTrain.append(trainRow);

	// }



});




